<div class="row gx-3">
    <div class="col-xxl-12 col-sm-12">
        <div class="card mb-3">
            <div class="card-body">
                <div class="row">
                    <div class='col-md-12 text-left'>
                      <div class="btn-group" role="group" aria-label="Toolbar">
                          <button id='tambah_data_resep_dokter' class='btn btn-success' data-bs-toggle='tooltip' data-bs-placement='top' title='Edit Data' {?=isset_or($disabled_menu.resep_dokter.create)?}>
                          <i class='ri-add-circle-line' style='font-size: 15px;'></i><span class="hidden-xs"> Tambah</span>
                          </button>
                          <button id='edit_data_resep_dokter' class='btn btn-primary' data-bs-toggle='tooltip' data-bs-placement='top' title='Edit Data' {?=isset_or($disabled_menu.resep_dokter.update)?}>
                          <i class='ri-edit-circle-line' style='font-size: 15px;'></i><span class="hidden-xs"> Edit</span>
                          </button>
                          <button id='hapus_data_resep_dokter' class='btn btn-danger' data-bs-toggle='tooltip' data-bs-placement='top' title='Hapus Data' {?=isset_or($disabled_menu.resep_dokter.delete)?}>
                          <i class='ri-delete-bin-line' style='font-size: 15px;'></i><span class="hidden-xs"> Hapus</span>
                          </button>
                      </div>
                    </div>
                </div>
                <div class="table-responsive">
                    <table id="tbl_resep_dokter" class="table table-striped table-hover display dataTable" style="width:100%">
                        <thead>
                        <tr> 
                            <th>[]</th>
                            <th>No Resep</th>
                            <th>Tgl Perawatan</th>
                            <th>Jam</th>
                            <th>No Rawat</th>
                            <th>Kd Dokter</th>
                            <th>Nm Dokter</th>
                            <th>Tgl Peresepan</th>
                            <th>Jam Peresepan</th>
                            <th>Status</th>
                            <th>Tgl Penyerahan</th>
                            <th>Jam Penyerahan</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="modal_resep_dokter" class="modal fade" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title"><span id="modal-title">Edit Data Resep Obat</span></h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form name="form_resep_dokter">
        <input type="hidden" class="form-control" id="typeact" /> 
        <div class='row gx-3'>
            <div class='col-xxl-4 col-lg-4 col-sm-6'>
                <div class='mb-3'>
                <label class='form-label' for='no_resep'>No Resep</label>
                <div class="input-group">
                  <input type='text' class='form-control' id='no_resep' name='no_resep' />
                  <button type="button" class="btn btn-success" id="refresh_no_resep"><i class="ri-refresh-line"></i></button>  
                </div>
                <div class='invalid-feedback error'></div>
                </div>
            </div>
            <div class='col-xxl-4 col-lg-4 col-sm-6'>
                <div class='mb-3'>
                <label class='form-label' for='no_rawat'>No Rawat</label>
                <input type='text' class='form-control' id='no_rawat_resep_dokter' name='no_rawat' />
                <div class='invalid-feedback error'></div>
                </div>
            </div>
            <div class='col-xxl-4 col-lg-4 col-sm-6'>
                <div class='mb-3'>
                <label class='form-label' for='kd_dokter'>Kd Dokter</label>
                <select class="form-select" name="kd_dokter" id="kd_dokter">
                  <option value="">Select</option>
                  {loop: $view.dokter}
                  <option value="{$value.kd_dokter}" {if: $value.kd_dokter == $view.user}selected{/if}>{$value.nm_dokter}</option>
                  {/loop}
                </select>
                <div class='invalid-feedback error'></div>
                </div>
            </div>
            <div class='col-xxl-4 col-lg-4 col-sm-6'>
                <div class='mb-3'>
                <label class='form-label' for='tgl_peresepan'>Tgl Peresepan</label>
                <input type='text' class='form-control datepicker' id='tgl_peresepan' name='tgl_peresepan' />
                <div class='invalid-feedback error'></div>
                </div>
            </div>
            <div class='col-xxl-4 col-lg-4 col-sm-6'>
                <div class='mb-3'>
                <label class='form-label' for='jam_peresepan'>Jam Peresepan</label>
                <input type='text' class='form-control timepicker' id='jam_peresepan' name='jam_peresepan' />
                <div class='invalid-feedback error'></div>
                </div>
            </div>
            <div class='col-xxl-4 col-lg-4 col-sm-6'>
                <div class='mb-3'>
                <label class='form-label' for='status'>Status</label>
                <select class="form-select" name="status" id="status">
                  <option value="">Select</option>
                  <option value="ralan">Rawat Jalan</option>
                  <option value="ranap">Rawat Inap</option>
                </select>
                <div class='invalid-feedback error'></div>
                </div>
            </div>
            <div class="table-responsive">
              <table id="tbl_reg_periksa_databarang" class="table table-striped table-hover" width="100%">
                  <thead>
                    <tr>
                      <th></th>
                      <th>#</th>
                      <th width="200">Nama Obat</th>
                      <th>Jumlah</th>
                      <th>Aturan Pakai</th>     
                      <th>Harga Dasar</th>
                      <th>Harga Beli</th>
                      <th>Expire</th>
                      <th>Kapasitas</th>
                    </tr>
                  </thead>
                
                  <tbody>
                    {loop: $view.databarang}
                    <tr>
                      <td></td>
                      <td><input id="{$value.kode_brng}" class="form-check-input" type="checkbox" name="kode_brng[]" id="kode_brng" value="{$value.kode_brng}"></td>
                      <td>{$value.nama_brng}</td>
                      <td><input type="text" name="jml[]" id="jml" class="form-control" style="margin: 0px !important;"></td>
                      <td><input type="text" name="aturan_pakai[]" id="aturan_pakai" class="form-control" style="margin: 0px !important;"></td>
                      <td>{$value.dasar}</td>
                      <td>{$value.h_beli}</td>
                      <th>{$value.expire}</th>
                      <td>{$value.kapasitas}</td>
                    </tr>
                    {/loop}
                  </tbody>
              </table>
            </div> 
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-bs-dismiss="modal"><i class="ri-close-line"></i> Batal </button>
        <button type="submit" id="simpan_data_resep_dokter" class="btn btn-primary"><i class="ri-save-3-line"></i> Simpan </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modal_resep_dokter_edit" class="modal fade" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title"><span id="modal-title">Edit Data Resep Obat</span></h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form name="form_resep_dokter_edit">
        <input type="hidden" class="form-control" id="typeact" /> 
        <div class='row gx-3'>
            <div class='col-xxl-4 col-lg-4 col-sm-6'>
                <div class='mb-3'>
                <label class='form-label' for='no_resep'>No Resep</label>
                <div class="input-group">
                  <input type='text' class='form-control' id='no_resep_edit' name='no_resep' />
                  <button type="button" class="btn btn-success" id="refresh_no_resep"><i class="ri-refresh-line"></i></button>  
                </div>
                <div class='invalid-feedback error'></div>
                </div>
            </div>
            <div class='col-xxl-4 col-lg-4 col-sm-6'>
                <div class='mb-3'>
                <label class='form-label' for='no_rawat'>No Rawat</label>
                <input type='text' class='form-control' id='no_rawat_resep_dokter_edit' name='no_rawat' />
                <div class='invalid-feedback error'></div>
                </div>
            </div>
            <div class='col-xxl-4 col-lg-4 col-sm-6'>
                <div class='mb-3'>
                <label class='form-label' for='kd_dokter'>Kd Dokter</label>
                <select class="form-select" name="kd_dokter" id="kd_dokter">
                  <option value="">Select</option>
                  {loop: $view.dokter}
                  <option value="{$value.kd_dokter}" {if: $value.kd_dokter == $view.user}selected{/if}>{$value.nm_dokter}</option>
                  {/loop}
                </select>
                <div class='invalid-feedback error'></div>
                </div>
            </div>
            <div class='col-xxl-4 col-lg-4 col-sm-6'>
                <div class='mb-3'>
                <label class='form-label' for='tgl_peresepan'>Tgl Peresepan</label>
                <input type='text' class='form-control datepicker' id='tgl_peresepan' name='tgl_peresepan' />
                <div class='invalid-feedback error'></div>
                </div>
            </div>
            <div class='col-xxl-4 col-lg-4 col-sm-6'>
                <div class='mb-3'>
                <label class='form-label' for='jam_peresepan'>Jam Peresepan</label>
                <input type='text' class='form-control timepicker' id='jam_peresepan' name='jam_peresepan' />
                <div class='invalid-feedback error'></div>
                </div>
            </div>
            <div class='col-xxl-4 col-lg-4 col-sm-6'>
                <div class='mb-3'>
                <label class='form-label' for='status'>Status</label>
                <select class="form-select" name="status" id="status_edit">
                  <option value="">Select</option>
                  <option value="ralan">Rawat Jalan</option>
                  <option value="ranap">Rawat Inap</option>
                </select>
                <div class='invalid-feedback error'></div>
                </div>
            </div>
            <div id="forTable_resep_dokter_edit"></div>
            <!-- <div id="repeat-div">
              <div class="outer row">
                <div class='col-xxl-4 col-lg-4 col-sm-6'>
                    <div class='mb-3'>
                    <label class='form-label' for='kode_brng'>Kode Brng</label>
                    <select class="form-select" name="kode_brng[]" id="kode_brng">
                      <option value="">Select</option>
                      {loop: $view.databarang}
                      <option value="{$value.kode_brng}" data-subtitle="{$value.h_beli}" data-right="{$value.kapasitas}">{$value.nama_brng}</option>
                      {/loop}
                    </select>
                    <div class='invalid-feedback error'></div>
                    </div>
                </div>
                <div class='col-xxl-4 col-lg-4 col-sm-6'>
                    <div class='mb-3'>
                    <label class='form-label' for='aturan_pakai'>Aturan Pakai</label>
                    <input type='text' class='form-control' id='aturan_pakai' name='aturan_pakai[]' />
                    <div class='invalid-feedback error'></div>
                    </div>
                </div>
                <div class='col-xxl-4 col-lg-4 col-sm-6'>
                    <div class='mb-3'>
                    <label class='form-label' for='jml'>Jml</label>
                    <div class="input-group">
                      <input type='text' class='form-control' id='jml' name='jml[]' />
                      <button class="btn btn-success btn-add" type="button"><i class="ri-add-line"></i></button>                  
                    </div>
                    <div class='invalid-feedback error'></div>
                    </div>
                </div>
              </div>
            </div> -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-bs-dismiss="modal"><i class="ri-close-line"></i> Batal </button>
        <button type="submit" id="simpan_data_resep_dokter" class="btn btn-primary"><i class="ri-save-3-line"></i> Simpan </button>
        </form>
      </div>
    </div>
  </div>
</div>

<div id="modal_lihat_resep_dokter" class="modal fade" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title"><span id="modal-title">Lihat Data Resep Obat</span></h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="forTable_resep_dokter"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-bs-dismiss="modal"><i class="ri-close-line"></i> Tutup </button>
        <button type="submit" id="export_pdf" class="btn btn-danger">
          <i class="ri-file-pdf-2-line"></i> PDF </button>
        <button type="submit" id="export_xlsx" class="btn btn-success">
          <i class="ri-file-excel-2-line"></i> XLSX </button>
      </div>
    </div>
  </div>
</div>

<div id="modal_detail_resep_dokter" class="modal fade" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable" role="document">
    <div class="modal-content">
      ...
    </div>
  </div>
</div>

<script>
  $("#modal_resep_dokter_edit").on('show.bs.modal', function () {
    // alert('The modal is about to be shown.');
        var search_field_resep_dokter = 'no_resep';
        var search_text_resep_dokter = $('#no_resep_edit').val();


        $.ajax({
            url: "{?=url(['resep_dokter','aksi'])?}",
            method: "POST",
            data: {
                typeact: 'lihat', 
                search_field_resep_dokter: search_field_resep_dokter, 
                search_text_resep_dokter: search_text_resep_dokter
            },
            dataType: 'json',
            success: function (res) {
                var eTable = "<div class='table-responsive'><table id='tbl_lihat_resep_dokter' class='table display dataTable' style='width:100%'><thead><th>Kode Brng</th><th>Nama Brng</th><th>Jml</th><th>Aturan Pakai</th></thead>";
                for (var i = 0; i < res.length; i++) {
                    eTable += "<tr>";
                    eTable += '<td><input type="text" class="form-control" id="kode_brng" name="kode_brng[]" value="' + res[i]['kode_brng'] + '" readonly></td>';
                    eTable += '<td>' + res[i]['nama_brng'] + '</td>';
                    eTable += '<td><input type="text" class="form-control" id="jml" name="jml[]" value="' + res[i]['jml'] + '"></td>';
                    eTable += '<td><input type="text" class="form-control" id="jaturan_pakaiml" name="aturan_pakai[]" value="' + res[i]['aturan_pakai'] + '"></td>';
                    eTable += "</tr>";
                }
                eTable += "</tbody></table></div>";
                $('#forTable_resep_dokter_edit').html(eTable);
            }
        });    
  });  
</script>