<div class="modal-header">
    <h4 class="modal-title">Detail Operasi</h4>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
    <div id="detail_operasi"></div>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="ri-close-line"></i> Tutup</button>
    <button type="submit" id="export_pdf_detail" class="btn btn-danger"><i class="ri-file-pdf-2-line"></i> PDF</button>
</div>
<script>
$(document).ready(function() {

    $.ajax({
        url: "{?=url(['operasi','read', $no_rawat])?}",
        method: "GET",
        data: {},
        dataType: 'json',
        success: function (res) {
            var eTable = "<div class='table-responsive'><table id='tbl_detail_operasi' class='table display dataTable' style='width:100%'><thead></thead>";
eTable += '<tr><td>No Rawat</td><td>' + res.msg['no_rawat'] + '</td><tr>';
eTable += '<tr><td>Tgl Operasi</td><td>' + res.msg['tgl_operasi'] + '</td><tr>';
eTable += '<tr><td>Jenis Anasthesi</td><td>' + res.msg['jenis_anasthesi'] + '</td><tr>';
eTable += '<tr><td>Kategori</td><td>' + res.msg['kategori'] + '</td><tr>';
eTable += '<tr><td>Operator1</td><td>' + res.msg['operator1'] + '</td><tr>';
eTable += '<tr><td>Operator2</td><td>' + res.msg['operator2'] + '</td><tr>';
eTable += '<tr><td>Operator3</td><td>' + res.msg['operator3'] + '</td><tr>';
eTable += '<tr><td>Asisten Operator1</td><td>' + res.msg['asisten_operator1'] + '</td><tr>';
eTable += '<tr><td>Asisten Operator2</td><td>' + res.msg['asisten_operator2'] + '</td><tr>';
eTable += '<tr><td>Asisten Operator3</td><td>' + res.msg['asisten_operator3'] + '</td><tr>';
eTable += '<tr><td>Instrumen</td><td>' + res.msg['instrumen'] + '</td><tr>';
eTable += '<tr><td>Dokter Anak</td><td>' + res.msg['dokter_anak'] + '</td><tr>';
eTable += '<tr><td>Perawaat Resusitas</td><td>' + res.msg['perawaat_resusitas'] + '</td><tr>';
eTable += '<tr><td>Dokter Anestesi</td><td>' + res.msg['dokter_anestesi'] + '</td><tr>';
eTable += '<tr><td>Asisten Anestesi</td><td>' + res.msg['asisten_anestesi'] + '</td><tr>';
eTable += '<tr><td>Asisten Anestesi2</td><td>' + res.msg['asisten_anestesi2'] + '</td><tr>';
eTable += '<tr><td>Bidan</td><td>' + res.msg['bidan'] + '</td><tr>';
eTable += '<tr><td>Bidan2</td><td>' + res.msg['bidan2'] + '</td><tr>';
eTable += '<tr><td>Bidan3</td><td>' + res.msg['bidan3'] + '</td><tr>';
eTable += '<tr><td>Perawat Luar</td><td>' + res.msg['perawat_luar'] + '</td><tr>';
eTable += '<tr><td>Omloop</td><td>' + res.msg['omloop'] + '</td><tr>';
eTable += '<tr><td>Omloop2</td><td>' + res.msg['omloop2'] + '</td><tr>';
eTable += '<tr><td>Omloop3</td><td>' + res.msg['omloop3'] + '</td><tr>';
eTable += '<tr><td>Omloop4</td><td>' + res.msg['omloop4'] + '</td><tr>';
eTable += '<tr><td>Omloop5</td><td>' + res.msg['omloop5'] + '</td><tr>';
eTable += '<tr><td>Dokter Pjanak</td><td>' + res.msg['dokter_pjanak'] + '</td><tr>';
eTable += '<tr><td>Dokter Umum</td><td>' + res.msg['dokter_umum'] + '</td><tr>';
eTable += '<tr><td>Kode Paket</td><td>' + res.msg['kode_paket'] + '</td><tr>';
eTable += '<tr><td>Biayaoperator1</td><td>' + res.msg['biayaoperator1'] + '</td><tr>';
eTable += '<tr><td>Biayaoperator2</td><td>' + res.msg['biayaoperator2'] + '</td><tr>';
eTable += '<tr><td>Biayaoperator3</td><td>' + res.msg['biayaoperator3'] + '</td><tr>';
eTable += '<tr><td>Biayaasisten Operator1</td><td>' + res.msg['biayaasisten_operator1'] + '</td><tr>';
eTable += '<tr><td>Biayaasisten Operator2</td><td>' + res.msg['biayaasisten_operator2'] + '</td><tr>';
eTable += '<tr><td>Biayaasisten Operator3</td><td>' + res.msg['biayaasisten_operator3'] + '</td><tr>';
eTable += '<tr><td>Biayainstrumen</td><td>' + res.msg['biayainstrumen'] + '</td><tr>';
eTable += '<tr><td>Biayadokter Anak</td><td>' + res.msg['biayadokter_anak'] + '</td><tr>';
eTable += '<tr><td>Biayaperawaat Resusitas</td><td>' + res.msg['biayaperawaat_resusitas'] + '</td><tr>';
eTable += '<tr><td>Biayadokter Anestesi</td><td>' + res.msg['biayadokter_anestesi'] + '</td><tr>';
eTable += '<tr><td>Biayaasisten Anestesi</td><td>' + res.msg['biayaasisten_anestesi'] + '</td><tr>';
eTable += '<tr><td>Biayaasisten Anestesi2</td><td>' + res.msg['biayaasisten_anestesi2'] + '</td><tr>';
eTable += '<tr><td>Biayabidan</td><td>' + res.msg['biayabidan'] + '</td><tr>';
eTable += '<tr><td>Biayabidan2</td><td>' + res.msg['biayabidan2'] + '</td><tr>';
eTable += '<tr><td>Biayabidan3</td><td>' + res.msg['biayabidan3'] + '</td><tr>';
eTable += '<tr><td>Biayaperawat Luar</td><td>' + res.msg['biayaperawat_luar'] + '</td><tr>';
eTable += '<tr><td>Biayaalat</td><td>' + res.msg['biayaalat'] + '</td><tr>';
eTable += '<tr><td>Biayasewaok</td><td>' + res.msg['biayasewaok'] + '</td><tr>';
eTable += '<tr><td>Akomodasi</td><td>' + res.msg['akomodasi'] + '</td><tr>';
eTable += '<tr><td>Bagian Rs</td><td>' + res.msg['bagian_rs'] + '</td><tr>';
eTable += '<tr><td>Biaya Omloop</td><td>' + res.msg['biaya_omloop'] + '</td><tr>';
eTable += '<tr><td>Biaya Omloop2</td><td>' + res.msg['biaya_omloop2'] + '</td><tr>';
eTable += '<tr><td>Biaya Omloop3</td><td>' + res.msg['biaya_omloop3'] + '</td><tr>';
eTable += '<tr><td>Biaya Omloop4</td><td>' + res.msg['biaya_omloop4'] + '</td><tr>';
eTable += '<tr><td>Biaya Omloop5</td><td>' + res.msg['biaya_omloop5'] + '</td><tr>';
eTable += '<tr><td>Biayasarpras</td><td>' + res.msg['biayasarpras'] + '</td><tr>';
eTable += '<tr><td>Biaya Dokter Pjanak</td><td>' + res.msg['biaya_dokter_pjanak'] + '</td><tr>';
eTable += '<tr><td>Biaya Dokter Umum</td><td>' + res.msg['biaya_dokter_umum'] + '</td><tr>';
eTable += '<tr><td>Status</td><td>' + res.msg['status'] + '</td><tr>';

            eTable += "</tbody></table></div>";
            $('#detail_operasi').html(eTable);
        }
    });

    // ===========================================
    // Ketika tombol export pdf di tekan
    // ===========================================
    $("#export_pdf_detail").click(function () {
        var doc = new jsPDF('p', 'pt', 'A4'); /* pilih 'l' atau 'p' */
        var img = "{?=base64_encode(file_get_contents(url($settings['logo'])))?}";
        doc.addImage(img, 'JPEG', 20, 10, 50, 50);
        doc.setFontSize(20);
        doc.text("{$settings.nama_instansi}", 80, 35, null, null, null);
        doc.setFontSize(10);
        doc.text("{$settings.alamat} - {$settings.kota} - {$settings.propinsi}", 80, 46, null, null, null);
        doc.text("Telepon: {$settings.nomor_telepon} - Email: {$settings.email}", 80, 56, null, null, null);
        doc.line(20,70,572,70,null); /* doc.line(20,70,820,70,null); --> Jika landscape */
        doc.line(20,72,572,72,null); /* doc.line(20,72,820,72,null); --> Jika landscape */
        doc.setFontSize(14);
        doc.text("Data Detail", 20, 95, null, null, null);
        const totalPagesExp = "{total_pages_count_string}";        
        doc.autoTable({
            html: '#tbl_detail_operasi',
            startY: 105,
            margin: {
                left: 20, 
                right: 20
            }, 
            styles: {
                fontSize: 10,
                cellPadding: 5
            }, 
            didDrawPage: data => {
                let footerStr = "Page " + doc.internal.getNumberOfPages();
                if (typeof doc.putTotalPages === 'function') {
                footerStr = footerStr + " of " + totalPagesExp;
                }
                doc.setFontSize(10);
                doc.text(`Â© ${new Date().getFullYear()} {$settings.nama_instansi}.`, data.settings.margin.left, doc.internal.pageSize.height - 10);                
                doc.text(footerStr, data.settings.margin.left + 480, doc.internal.pageSize.height - 10);
           }
        });
        if (typeof doc.putTotalPages === 'function') {
            doc.putTotalPages(totalPagesExp);
        }
        // doc.save('detail_data_operasi.pdf')
        window.open(doc.output('bloburl'), '_blank',"toolbar=no,status=no,menubar=no,scrollbars=no,resizable=no,modal=yes");  
              
    }) 
}); 
</script>