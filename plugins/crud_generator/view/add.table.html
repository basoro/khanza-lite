<div class="modal-header">
    <h4 class="modal-title">Add Table</h4>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
    <div class="row gx-3">
        <div class="col-xxl-12 col-lg-12 col-sm-12">
            <div class="mb-3">
              <label class="form-label" for="tgl_daftar">Nama Tabel <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="table_name" name="table_name" placeholder="Enter Table Name">
            </div>
        </div>
        <div id="repeat-div">
            <div class="outer row">
                <div class='col-xxl-3 col-lg-3 col-sm-6'>
                    <div class='mb-3'>
                    <label class='form-label' for='column_name'>Nama Kolom</label>
                    <input type='text' class='form-control' id='column_name' name='column_name[]' />
                    <div class='invalid-feedback error'></div>
                    </div>
                </div>
                <div class='col-xxl-3 col-lg-3 col-sm-6'>
                    <div class='mb-3'>
                    <label class='form-label' for='column_type'>Tipe</label>
                    <select class="form-select" name="column_type[]" id="column_type">
                        <option value="INT">INT</option>
                        <option value="VARCHAR">VARCHAR</option>
                        <option value="TEXT">TEXT</option>
                        <option value="DATE">DATE</option>
                        <option value="DATETIME">DATETIME</option>
                    </select>
                    <div class='invalid-feedback error'></div>
                    </div>
                </div>
                <div class='col-xxl-3 col-lg-3 col-sm-6'>
                    <div class='mb-3'>
                    <label class='form-label' for='column_length'>Length/Value</label>
                    <input type='text' class='form-control' id='column_length' name='column_length[]' />
                    <div class='invalid-feedback error'></div>
                    </div>
                </div>
                <div class='col-xxl-3 col-lg-3 col-sm-6'>
                    <div class='mb-3'>
                    <label class='form-label' for='default'>Default</label>
                    <div class="input-group">
                        <input type='text' class='form-control' id='column_default' name='column_default[]' />
                        <button class="btn btn-success btn-add" type="button"><i class="ri-add-line"></i></button>                  
                    </div>
                    <div class='invalid-feedback error'></div>
                    </div>
                </div>
            </div>
        </div>        
    </div>
</div>
<div class="modal-footer">
  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="ri-close-line"></i> Tutup </button>
  <button type="button" id="save_add_table" class="btn btn-primary"><i class="ri-file-save-line"></i> SIMPAN</button>
</div>

<script>
    $("#save_add_table").click(function (event) {
        event.preventDefault();
        
        var table_name = $('#table_name').val();
        var column_name = $('#column_name').val();
        var column_type = $('#column_type').val();
        var column_length = $('#column_length').val();
        var column_default = $('#column_default').val();

        var formData = new FormData(); // tambahan
        formData.append('table_name', table_name); // tambahan
        formData.append('column_name', column_name); // tambahan
        formData.append('column_type', column_type); // tambahan
        formData.append('column_length', column_length); // tambahan
        formData.append('column_default', column_default); // tambahan

        // $.ajax({
        //     type: 'POST',
        //     url: "{?=url(['crud_generator','saveaddtable'])?}",
        //         method: "POST",
        //         contentType: false, // tambahan
        //         processData: false, // tambahan
        //         data: formData,
        //     data: {
        //         add_table_name: add_table_name, 
        //         add_column_name: add_column_name, 
        //         add_column_type: add_column_type, 
        //         add_column_length: add_column_length, 
        //         add_column_default: add_column_default
        //     },
        //     success: function(result) {
        //         console.log(result);
        //     },
        //     error: function(err) {
        //         console.log(err);
        //     }
        // });

        $.ajax({
            url: "{?=url(['crud_generator','saveaddtable'])?}",
            method: "POST",
            contentType: false, // tambahan
            processData: false, // tambahan
            data: formData,
            success: function (data) {
                console.log(data);
                data = JSON.parse(data);
                var audio = new Audio('{?=url()?}/assets/sound/' + data.status + '.mp3');
                audio.play();
                if(data.status === 'success') {
                    bootbox.alert('<span class="text-success">' + data.msg + '</span>');
                } else {
                    bootbox.alert('<span class="text-danger">' + data.msg + '</span>');
                }    
            }
        })
    })      
</script>