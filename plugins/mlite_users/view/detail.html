<div class="modal-header">
    <h4 class="modal-title">Detail Mlite Users</h4>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
    <img src="data:image/png;base64,{$detail.avatar_img}" height="96" style="margin-bottom: 20px;">
    <table id="tbl_detail_mlite_users" class="table table-bordered table-striped" style="width:100%">
        <thead>
        </thead>
        <tbody>
            <tr><td>Id</td><td colspan="5">{$detail.id}</td><tr>
            <tr><td>Username</td><td colspan="5">{$detail.username}</td><tr>
            <tr><td>Fullname</td><td colspan="5">{$detail.fullname}</td><tr>
            <tr><td>Description</td><td colspan="5">{$detail.description}</td><tr>
            <tr><td>Password</td><td colspan="5">{$detail.password}</td><tr>
            <tr><td>Email</td><td colspan="5">{$detail.email}</td><tr>
            <tr><td>Role</td><td colspan="5">{$detail.role}</td><tr>
            <tr><td>Cap</td><td colspan="5">{$detail.cap}</td><tr>
            <tr>
                <td colspan="6">Access and Permission</td>
            </tr>
            <tr>
                <th>Access</th>
                <th>Create</th>
                <th>Read</th>
                <th>Update</th>
                <th>Delete</th>
                <th>Menu</th>
            </tr>
            {loop: $detail.permission}
            <tr>
                <td>{$value.module}</td>
                <td>{$value.create}</td>
                <td>{$value.read}</td>
                <td>{$value.update}</td>
                <td>{$value.delete}</td>
                <td>{$value.hidden}</td>
            </tr>
            {/loop}
        </tbody>
    </table>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="ri-close-line"></i> Tutup</button>
    <button type="submit" id="export_pdf_detail" class="btn btn-primary"><i class="ri-file-pdf-2-line"></i> PDF</button>
</div>
<script>
    // ===========================================
    // Ketika tombol export pdf di tekan
    // ===========================================
    $("#export_pdf_detail").click(function () {
        var doc = new jsPDF('p', 'pt', 'A4'); /* pilih 'l' atau 'p' */
        var img = "{?=base64_encode(file_get_contents(url($settings['logo'])))?}";
        doc.addImage(img, 'JPEG', 20, 10, 50, 50);
        var avatar_img = "{$detail.0.avatar_img}";
        doc.addImage(avatar_img, 'JPEG', 20, 110, 50, 50);
        doc.setFontSize(20);
        doc.text("{$settings.nama_instansi}", 80, 35, null, null, null);
        doc.setFontSize(10);
        doc.text("{$settings.alamat} - {$settings.kota} - {$settings.propinsi}", 80, 46, null, null, null);
        doc.text("Telepon: {$settings.nomor_telepon} - Email: {$settings.email}", 80, 56, null, null, null);
        doc.line(20,70,572,70,null); /* doc.line(20,70,820,70,null); --> Jika landscape */
        doc.line(20,72,572,72,null); /* doc.line(20,72,820,72,null); --> Jika landscape */
        doc.setFontSize(14);
        doc.text("Detail Data Pengguna", 20, 95, null, null, null);
        const totalPagesExp = "{total_pages_count_string}";        
        doc.autoTable({
            html: '#tbl_detail_mlite_users',
            startY: 170,
            margin: {
                left: 20, 
                right: 20
            }, 
            styles: {
                fontSize: 10,
                cellPadding: 5
            }, 
            didDrawPage: data => {
                let footerStr = "Page " + doc.internal.getNumberOfPages();
                if (typeof doc.putTotalPages === 'function') {
                footerStr = footerStr + " of " + totalPagesExp;
                }
                doc.setFontSize(10);
                doc.text(`Â© ${new Date().getFullYear()} {$settings.nama_instansi}.`, data.settings.margin.left, doc.internal.pageSize.height - 10);                
                doc.text(footerStr, data.settings.margin.left + 480, doc.internal.pageSize.height - 10);
           }
        });
        if (typeof doc.putTotalPages === 'function') {
            doc.putTotalPages(totalPagesExp);
        }
        // doc.save('table_data_propinsi.pdf')
        window.open(doc.output('bloburl'), '_blank',"toolbar=no,status=no,menubar=no,scrollbars=no,resizable=no,modal=yes");  
              
    })    
</script>